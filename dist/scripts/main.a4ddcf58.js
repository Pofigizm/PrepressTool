"use strict";function comnum(a,b){return a-b}function dashview(a){a.sort(comnum),angular.forEach(a,function(b,c){a[c]=[Number(b)]});for(var b=a.length-2;b>=0;b--)a[b+1][0]-a[b][a[b].length-1]===1&&a.splice(b,2,a[b].concat(a[b+1]));return angular.forEach(a,function(b,c){a[c]=String(b.length>1?b[0]+"-"+b[b.length-1]:b[0])}),a}function cleartoarray(a){var b=a.replace(/[^0-9,-]/g,"").split(","),c=[];return angular.forEach(b,function(a){for(var b=a.split("-").sort(comnum),d=+b[0];d<=+b[b.length-1];d++)d>0&&c.push(d)}),c}function divide(a,b){return Math.ceil(+a/+b)*+b}function unique(a,b){for(var c={},d=0;d<a.length;d++){var e=a[d];+e>=1&&b>=+e&&(c[e]=!0)}return Object.keys(c)}function signjoin(a,b){b&&a.reverse();for(var c=1;c<a.length;c++)if(a[c].color===a[c-1].color&&a[c].pagearr.length===a[c-1].pagearr.length){var d=a[c].sheetSize<a[c].maxSign?a[c].sheetSize:a[c].maxSign;if(a[c].pagearr.length<d){var e=new Object(a[c]);e.pagearr=unique(a[c-1].pagearr.concat(a[c].pagearr),a[c].allSign),a.splice(c-1,2,e)}}return b&&a.reverse(),a}function signtosheet(a){var b=[];return angular.forEach(a,function(a){for(var c=0,d=1;d<=b.length;d++)if(a.sheetSize-b[d-1].pages>=a.pages){c=d;break}0===c&&(c=b.length+1,b[c-1]={pages:0,signatures:[]}),b[c-1].signatures.push(a),b[c-1].pages+=a.pages}),b}angular.module("prepresstoolApp",[]),angular.module("prepresstoolApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.pages={bind:1,all:48,color:"1-4, 6, 21, 45",min:4,max:8,maxGray:16,maxColor:8,rev:!0},a.rebuild=function(){for(var b=Number(a.pages.bind),c=divide(a.pages.min,2*b),d=divide(a.pages.max,c),e=divide(a.pages.maxGray,c),f=divide(a.pages.maxColor,c),g=f>e?f:e,h=divide(a.pages.all,c),i=unique(cleartoarray(a.pages.color),h),j=a.pages.rev,k=[],l=0;h/b>l;l++)l>=k.length*c/b&&k.push({allSign:h,maxSign:d,sheetSize:e,color:!1,pagearr:[]}),k[k.length-1].pagearr.push(l+1);if(2===b)for(var m=h/b;h>m;m++)k[Math.ceil((h-m)/(c/b))-1].pagearr.push(m+1);angular.forEach(k,function(a){angular.forEach(a.pagearr,function(b){angular.forEach(i,function(c){c==b&&(a.sheetSize=f,a.color=!0)})})});for(var n=c;d>n;n=2*n)k=signjoin(k,j);angular.forEach(k,function(a,b){a.number=b+1,a.pages=a.pagearr.length,a.dashpages=dashview(a.pagearr),a.colspan=a.pages/2,a.colorstyle=a.color?"color":"gray"});var o=[],p=[];angular.forEach(k,function(a){a.color?o.push(a):p.push(a)});var q=[].concat(signtosheet(o)).concat(signtosheet(p));angular.forEach(q,function(a,b){a.number=("00"+(b+1)).slice(-3)});var r={};r.number="number:",r.signatures=[];for(var s=0;g/2>s;s++)r.signatures.push({allSign:h,pages:2,colspan:1,colorstyle:"notback",pagearr:[]});q.splice(0,0,r),a.clearpages={bind:b,bindastext:1===b?"PerfectBound":"SaddleStich",all:h,color:dashview(i).join(", "),min:c,max:d,maxGray:e,maxColor:f,rev:j},a.signatures=k,a.sheets=q},a.rebuild()}]);