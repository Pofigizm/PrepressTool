"use strict";function cleartoarray(a){var b=a.replace(/[^0-9,-]/g,"").split(","),c=[];return angular.forEach(b,function(a){var b=a.split("-");if(1===b.length&&c.push(a),b.length>1&&b[0]>0&&(b[0]=+b[0],b[b.length-1]>0)){b[b.length-1]=+b[b.length-1],b[0]>b[b.length-1]&&b.reverse();for(var d=b[0];d<=b[b.length-1];d++)c.push(d)}}),c}function divide(a,b){return Math.ceil(+a/+b)*+b}function unique(a,b){for(var c={},d=0;d<a.length;d++){var e=a[d];+e>=1&&b>=+e&&(c[e]=!0)}return Object.keys(c)}function signjoin(a,b){b&&a.reverse();for(var c=1;c<a.length;c++)if(a[c].color===a[c-1].color&&a[c].pagearr.length===a[c-1].pagearr.length&&a[c].pagearr.length<a[c].maxSign){var d=new Object(a[c]);d.pagearr=unique(a[c-1].pagearr.concat(a[c].pagearr),a[c].allSign),a.splice(c-1,2,d)}return b&&a.reverse(),a}function signtosheet(a){var b=[];return angular.forEach(a,function(a){for(var c=0,d=1;d<=b.length;d++)if(a.maxSign-b[d-1].pages>=a.pages){c=d;break}0===c&&(c=b.length+1,b[c-1]={pages:0,signatures:[]}),b[c-1].signatures.push(a),b[c-1].pages+=a.pages}),b}angular.module("prepresstoolApp",[]),angular.module("prepresstoolApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.pages={bind:"PerfectBound",all:48,color:"2, 6, 21, 45",min:4,maxGray:8,maxColor:8,rev:!0},a.rebuild=function(){for(var b="PerfectBound"===a.pages.bind?1:2,c=divide(a.pages.min,2*b),d=divide(a.pages.maxGray,c),e=divide(a.pages.maxColor,c),f=e>d?e:d,g=divide(a.pages.all,c),h=unique(cleartoarray(a.pages.color),g),i=a.pages.rev,j=[],k=0;g/b>k;k++)k>=j.length*c/b&&j.push({allSign:g,maxSign:d,color:!1,pagearr:[]}),j[j.length-1].pagearr.push(k+1);if(2===b)for(var l=g/b;g>l;l++)j[Math.ceil((g-l)/(c/b))-1].pagearr.push(l+1);angular.forEach(j,function(a){angular.forEach(a.pagearr,function(b){angular.forEach(h,function(c){c==b&&(a.maxSign=e,a.color=!0)})})});for(var m=c;f>m;m=2*m)j=signjoin(j,i);angular.forEach(j,function(a,b){a.number=b+1,a.pages=a.pagearr.length,a.colspan=a.pages/2,a.colorstyle=a.color?"color":"gray"});var n=[],o=[];angular.forEach(j,function(a){a.color?n.push(a):o.push(a)});var p=[].concat(signtosheet(n)).concat(signtosheet(o));angular.forEach(p,function(a,b){a.number=("00"+(b+1)).slice(-3)});var q={};q.number="number:",q.signatures=[];for(var r=0;f/2>r;r++)q.signatures.push({allSign:g,pages:2,colspan:1,colorstyle:"notback",pagearr:[]});p.splice(0,0,q),a.clearpages={bind:1===b?"PerfectBound":"SaddleStich",all:g,color:h.join(", "),min:c,maxGray:d,maxColor:e,rev:i},a.signatures=j,a.sheets=p,console.log(p)},a.rebuild()}]);